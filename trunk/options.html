<html>
  <head>
    <title>Gmail Favicon Notifier Options</title>
	
	<script type="text/javascript">
      // Saves options to localStorage.
      function save_options() {
        var select = document.getElementById("desktopNotification");
        var desktopNotification = select.children[select.selectedIndex].value;
		if(desktopNotification == 'true' && window.webkitNotifications.checkPermission() != 0) {
		  window.webkitNotifications.requestPermission(function() {
		    if(window.webkitNotifications.checkPermission() == 0) {
		      localStorage.desktopNotification = true;
		    } else {
			  localStorage.desktopNotification = false;
			}
		  });
		} else {
		  localStorage.desktopNotification = desktopNotification == 'true' ? true : false;
		}
		
		select = document.getElementById("chatNotification");
        var chatNotification = select.children[select.selectedIndex].value;
        localStorage.chatNotification = chatNotification == 'true' ? true : false;
		
		// 0 -> Only Priority Inbox
		// 1 -> Whole Inbox
		select = document.getElementById("checkArea");
        var checkArea = select.children[select.selectedIndex].value;
		localStorage.checkArea = checkArea;

		var newMailSoundNotification = document.getElementById("newMailSoundNotification").checked;
		if(newMailSoundNotification) {
		  localStorage.newMailSoundNotification = true;
		  select = document.getElementById("newMailSound");
          var newMailSound = select.children[select.selectedIndex].value;
		  localStorage.newMailSound = newMailSound;
		} else {
		  localStorage.newMailSoundNotification = false;
		  localStorage.newMailSound = '';
		}
		
        // Update status to let user know options were saved.
        var status = document.getElementById("status");
        status.innerHTML = "Options Saved.";
        setTimeout(function() {
          status.innerHTML = "";
        }, 1000);
      }

      // Restores select box state to saved value from localStorage.
      function restore_options() {
        var desktopNotificationValue = window.webkitNotifications.checkPermission() == 0 && (localStorage.desktopNotification == "true" || !localStorage.desktopNotification);
        var select = document.getElementById("desktopNotification");
        for (var i = 0; i < select.children.length; i++) {
          var child = select.children[i];
          if (child.value == "true" && desktopNotificationValue) {
            child.selected = "true";
            break;
          }
		  if (child.value == "false" && !desktopNotificationValue) {
            child.selected = "true";
            break;
          }
        }
		
		var chatNotificationValue = localStorage.chatNotification == "true" || !localStorage.chatNotification;
        select = document.getElementById("chatNotification");
        for (var i = 0; i < select.children.length; i++) {
          var child = select.children[i];
          if (child.value == "true" && chatNotificationValue) {
            child.selected = "true";
            break;
          }
		  if (child.value == "false" && !chatNotificationValue) {
		    child.selected = "true";
			break;
		  }
        }
		
		var checkAreaValue = localStorage.checkArea ? localStorage.checkArea : "0";
        select = document.getElementById("checkArea");
        for (var i = 0; i < select.children.length; i++) {
          var child = select.children[i];
          if ( (child.value == "0" && checkAreaValue == "0") || !checkAreaValue) {
            child.selected = "true";
            break;
          }
		  if (child.value == "1" && checkAreaValue == "1") {
            child.selected = "true";
            break;
          }
        }
		
		var newMailSoundNotificationValue = localStorage.newMailSoundNotification == "true" || !localStorage.newMailSoundNotification;
		if (newMailSoundNotificationValue) {
		  document.getElementById("newMailSoundNotification").checked = true;
		  select = document.getElementById("newMailSound");
          for (var i = 0; i < select.children.length; i++) {
            var child = select.children[i];
            if (child.value == localStorage.newMailSound) {
              child.selected = "true";
              break;
            }
          }
		  enableNewMailSoundNotification();
		} else {
		  document.getElementById("newMailSoundNotification").checked = false;
		  disableNewMailNotificationSound();
		}
      }
	  
	  function changeNewMailSoundNotificationStatus(elem) {
	    if(elem.checked) {
		  enableNewMailSoundNotification();
		} else {
		  disableNewMailSoundNotification();
		}
	  }
	  
	  function enableNewMailSoundNotification(elem) {
		document.getElementById('newMailSound').disabled = false;
		document.getElementById('newMailSoundPreview').style.display = "";
		document.getElementById('newMailSoundPreview').src =
		    document.getElementById('newMailSound').children[document.getElementById('newMailSound').selectedIndex].value;
	  }
	  
	  function disableNewMailSoundNotification() {
		document.getElementById('newMailSound').disabled = true;
		document.getElementById('newMailSoundPreview').style.display = "none";
	  }
	  
	  function changeNewMailSound() {
	    select = document.getElementById("newMailSound");
        document.getElementById('newMailSoundPreview').src = select.children[select.selectedIndex].value;
	  }
	  
    </script>
	<style>
	  h2 {
	    font-size: 18px;
	    padding: 0px;
	    margin: 0px;
	  }
	  p {
	    padding: 0px;
		margin: 5px 0px 5px 0px;
	  }
	  
	  div.main {
	    width: 600px;
		margin: 100px auto;
		padding: 0px 20px 10px 20px;
		border: solid 1px #AAAAAA;
		border-radius: 20px;
		-webkit-box-shadow: 2px 2px 5px #BBBBBB;
	  }
	  div.option {
	    margin: 30px 0px;
		padding: 0px;
	  }
	</style>
  </head>

  <body onload="restore_options()">
    <div class="main">
 	  <h1 style="border-bottom: solid 1px #AAAAAA; text-shadow: 1px 1px 2px #BBBBBB;"><img title="Gmail Favicon Notifier" alt="Gmail Favicon Notifier" src="icon48.png" style="vertical-align: -12px; margin-right: 10px;" />Gmail Favicon Notifier</h1>
	  <div class="option">
	    <p>
          Desktop notification:
          <select id="desktopNotification">
            <option value="true">Enable</option>
            <option value="false">Disable</option>
          </select>
        </p>
	  </div>
	  <div class="option">
	    <h2>Mail options:</h2>
	    <p>
	      Check for new mail in:
		  <select id="checkArea">
		    <option value="0">Priority Inbox</option>
 		    <option value="1">Inbox</option>
		  </select>
	    </p>
	    <p>
	      <input id="newMailSoundNotification" type="checkbox" onchange="changeNewMailSoundNotificationStatus(this)"/> Enable sound notification for new mail:
	      <br />
	        <select id="newMailSound" disabled="false" onchange="changeNewMailSound()">
            <option value="whoosh-19.mp3">Woosh</option>
            <option value="weird-wind1.mp3">Weird wind</option>
		    <option value="bubble-drop.mp3">Bubble drop</option>
		    <option value="bell-small.mp3">Bell small</option>
		    <option value="whoosh-15.mp3">Woosh 2</option>
		    <option value="bell-transition.mp3">Bell transition</option>
          </select>
		  <audio id="newMailSoundPreview" src="" controls="controls" style="vertical-align: -10px;"></audio>
        </p>
	  </div>
	  <div class="option">
		<h2>Chat options:</h2>
		<p>
		  Chat notification:
          <select id="chatNotification">
            <option value="true">Enable</option>
            <option value="false">Disable</option>
          </select>
        </p>
	  </div>
	  <p>
        <button onclick="save_options()">Save</button><span id="status"></span>
	  </p>
	</div>
  </body>
</html>